{% extends "base.html" %}
{% block content %}
<h2>Patients</h2>
<form class="row g-2 mb-3">
  <div class="col-auto">
    <input class="form-control" name="q" value="{{ q }}" placeholder="Search by name">
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-primary">Search</button>
  </div>
  <div class="col-auto ms-auto">
    <a class="btn btn-primary" href="{{ url_for('patients.create_patient') }}">Add patient</a>
  </div>
</form>

<table class="table table-striped">
  <thead><tr><th>Name</th><th>Age</th><th>Gender</th><th>Actions</th></tr></thead>
  <tbody>
  {% for p in pagination.items %}
    <tr>
      <td>{{ p.name }}</td>
      <td>{{ p.age or '-' }}</td>
      <td>{{ p.gender or '-' }}</td>
      <td>
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('patients.edit_patient', patient_id=p.id) }}">Edit</a>
        <form method="POST" action="{{ url_for('patients.delete_patient', patient_id=p.id) }}" style="display:inline">
          {{ csrf_token() }}
          <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete?')">Delete</button>
        </form>
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('tests.create_test', patient_id=p.id) }}">Add Test</a>
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('reports.create_report', patient_id=p.id) }}">Add Report</a>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<!-- simple pagination -->
<nav>
  <ul class="pagination">
    {% if pagination.has_prev %}
      <li class="page-item"><a class="page-link" href="{{ url_for('patients.list_patients', page=pagination.prev_num, q=q) }}">&laquo;</a></li>
    {% endif %}
    {% for page_num in pagination.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
      {% if page_num %}
        <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('patients.list_patients', page=page_num, q=q) }}">{{ page_num }}</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">â€¦</span></li>
      {% endif %}
    {% endfor %}
    {% if pagination.has_next %}
      <li class="page-item"><a class="page-link" href="{{ url_for('patients.list_patients', page=pagination.next_num, q=q) }}">&raquo;</a></li>
    {% endif %}
  </ul>
</nav>

{% endblock %}
